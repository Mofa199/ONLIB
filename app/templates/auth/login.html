{% extends "base.html" %}

{% block title %}Login - TAMSA Library{% endblock %}

{% block body_class %}auth-page{% endblock %}

{% block extra_css %}
<style>
    .auth-page {
        background: linear-gradient(135deg, #213874 0%, #1a6ac3 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }
    
    .main-content {
        padding-top: 0;
    }
    
    .auth-container {
        perspective: 1000px;
        width: 100%;
        max-width: 400px;
    }
    
    .auth-card {
        position: relative;
        width: 100%;
        height: 600px;
        transform-style: preserve-3d;
        transition: transform 0.6s;
    }
    
    .auth-card.flipped {
        transform: rotateY(180deg);
    }
    
    .card-face {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        border-radius: 15px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        background: white;
        padding: 40px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    
    .card-back {
        transform: rotateY(180deg);
    }
    
    .logo-container {
        text-align: center;
        margin-bottom: 30px;
    }
    
    .logo-container img {
        height: 60px;
        margin-bottom: 15px;
    }
    
    .logo-text {
        color: #213874;
        font-size: 24px;
        font-weight: 700;
        margin: 0;
    }
    
    .auth-title {
        color: #213874;
        font-size: 28px;
        font-weight: 600;
        text-align: center;
        margin-bottom: 30px;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-label {
        color: #213874;
        font-weight: 500;
        margin-bottom: 8px;
    }
    
    .form-control {
        border: 2px solid #e9ecef;
        border-radius: 10px;
        padding: 12px 15px;
        font-size: 16px;
        transition: all 0.3s ease;
    }
    
    .form-control:focus {
        border-color: #1a6ac3;
        box-shadow: 0 0 0 0.2rem rgba(26, 106, 195, 0.25);
    }
    
    .btn-auth {
        background: linear-gradient(135deg, #213874 0%, #1a6ac3 100%);
        border: none;
        border-radius: 10px;
        padding: 12px;
        font-size: 16px;
        font-weight: 600;
        color: white;
        width: 100%;
        transition: all 0.3s ease;
        margin-bottom: 20px;
    }
    
    .btn-auth:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(26, 106, 195, 0.3);
        color: white;
    }
    
    .flip-link {
        color: #1a6ac3;
        text-decoration: none;
        font-weight: 500;
        cursor: pointer;
        transition: color 0.3s ease;
    }
    
    .flip-link:hover {
        color: #213874;
        text-decoration: underline;
    }
    
    .track-selector {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 10px;
        margin-bottom: 20px;
    }
    
    .track-option {
        text-align: center;
        padding: 15px 10px;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: white;
    }
    
    .track-option:hover {
        border-color: #1a6ac3;
        background: #f8f9fa;
    }
    
    .track-option.selected {
        border-color: #1a6ac3;
        background: #e3f2fd;
        color: #213874;
    }
    
    .track-option i {
        font-size: 24px;
        margin-bottom: 8px;
        display: block;
    }
    
    .track-option .track-name {
        font-size: 12px;
        font-weight: 500;
    }
    
    .divider {
        text-align: center;
        margin: 20px 0;
        color: #6c757d;
        position: relative;
    }
    
    .divider::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        height: 1px;
        background: #e9ecef;
        z-index: 1;
    }
    
    .divider span {
        background: white;
        padding: 0 15px;
        position: relative;
        z-index: 2;
    }
    
    .forgot-password {
        text-align: center;
        margin-top: 15px;
    }
    
    .forgot-password a {
        color: #6c757d;
        text-decoration: none;
        font-size: 14px;
    }
    
    .forgot-password a:hover {
        color: #1a6ac3;
        text-decoration: underline;
    }
    
    .error-message {
        color: #dc3545;
        font-size: 14px;
        margin-top: 5px;
    }
    
    .success-message {
        color: #28a745;
        font-size: 14px;
        margin-top: 5px;
    }
    
    @media (max-width: 576px) {
        .auth-container {
            max-width: 100%;
        }
        
        .card-face {
            padding: 30px 25px;
        }
        
        .auth-card {
            height: auto;
            min-height: 600px;
        }
        
        .track-selector {
            grid-template-columns: 1fr;
            gap: 8px;
        }
        
        .track-option {
            padding: 12px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card" id="auth-card">
        <!-- Login Side -->
        <div class="card-face card-front">
            <div class="logo-container">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="TAMSA Library">
                <h1 class="logo-text">TAMSA Library</h1>
            </div>
            
            <h2 class="auth-title">Welcome Back</h2>
            
            <form id="login-form">
                <div class="form-group">
                    <label for="login-email" class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="login-email" name="email" required>
                    <div class="error-message" id="login-email-error"></div>
                </div>
                
                <div class="form-group">
                    <label for="login-password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="login-password" name="password" required>
                    <div class="error-message" id="login-password-error"></div>
                </div>
                
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="remember-me" name="remember">
                    <label class="form-check-label" for="remember-me">
                        Remember me
                    </label>
                </div>
                
                <button type="submit" class="btn btn-auth">
                    <i class="fas fa-sign-in-alt me-2"></i>Sign In
                </button>
                
                <div class="error-message text-center" id="login-error"></div>
                <div class="success-message text-center" id="login-success"></div>
            </form>
            
            <div class="divider">
                <span>or</span>
            </div>
            
            <div class="text-center">
                <p class="mb-0">Don't have an account? <a href="#" class="flip-link" id="flip-to-signup">Sign up here</a></p>
            </div>
            
            <div class="forgot-password">
                <a href="{{ url_for('auth.forgot_password') }}">Forgot your password?</a>
            </div>
        </div>
        
        <!-- Signup Side -->
        <div class="card-face card-back">
            <div class="logo-container">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="TAMSA Library">
                <h1 class="logo-text">TAMSA Library</h1>
            </div>
            
            <h2 class="auth-title">Join Us Today</h2>
            
            <form id="signup-form">
                <div class="form-group">
                    <label for="signup-name" class="form-label">Full Name</label>
                    <input type="text" class="form-control" id="signup-name" name="name" required>
                    <div class="error-message" id="signup-name-error"></div>
                </div>
                
                <div class="form-group">
                    <label for="signup-email" class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="signup-email" name="email" required>
                    <div class="error-message" id="signup-email-error"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Study Track</label>
                    <div class="track-selector">
                        <div class="track-option" data-track="Medical">
                            <i class="fas fa-stethoscope" style="color: #213874;"></i>
                            <div class="track-name">Medical</div>
                        </div>
                        <div class="track-option" data-track="Nursing">
                            <i class="fas fa-user-nurse" style="color: #1a6ac3;"></i>
                            <div class="track-name">Nursing</div>
                        </div>
                        <div class="track-option" data-track="Pharmacy">
                            <i class="fas fa-pills" style="color: #f3ab1b;"></i>
                            <div class="track-name">Pharmacy</div>
                        </div>
                    </div>
                    <input type="hidden" id="signup-track" name="track" required>
                    <div class="error-message" id="signup-track-error"></div>
                </div>
                
                <div class="form-group">
                    <label for="signup-password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="signup-password" name="password" required>
                    <div class="error-message" id="signup-password-error"></div>
                </div>
                
                <div class="form-group">
                    <label for="signup-confirm-password" class="form-label">Confirm Password</label>
                    <input type="password" class="form-control" id="signup-confirm-password" name="confirm_password" required>
                    <div class="error-message" id="signup-confirm-password-error"></div>
                </div>
                
                <button type="submit" class="btn btn-auth">
                    <i class="fas fa-user-plus me-2"></i>Create Account
                </button>
                
                <div class="error-message text-center" id="signup-error"></div>
                <div class="success-message text-center" id="signup-success"></div>
            </form>
            
            <div class="divider">
                <span>or</span>
            </div>
            
            <div class="text-center">
                <p class="mb-0">Already have an account? <a href="#" class="flip-link" id="flip-to-login">Sign in here</a></p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    const authCard = $('#auth-card');
    const flipToSignup = $('#flip-to-signup');
    const flipToLogin = $('#flip-to-login');
    const trackOptions = $('.track-option');
    
    // Flip card animations
    flipToSignup.click(function(e) {
        e.preventDefault();
        authCard.addClass('flipped');
        clearErrors();
    });
    
    flipToLogin.click(function(e) {
        e.preventDefault();
        authCard.removeClass('flipped');
        clearErrors();
    });
    
    // Track selection
    trackOptions.click(function() {
        trackOptions.removeClass('selected');
        $(this).addClass('selected');
        $('#signup-track').val($(this).data('track'));
        $('#signup-track-error').text('');
    });
    
    // Login form submission
    $('#login-form').submit(function(e) {
        e.preventDefault();
        clearErrors();
        
        const formData = {
            email: $('#login-email').val(),
            password: $('#login-password').val(),
            remember: $('#remember-me').is(':checked')
        };
        
        $.ajax({
            url: '{{ url_for("auth.login") }}',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function(response) {
                if (response.success) {
                    $('#login-success').text(response.message);
                    setTimeout(function() {
                        window.location.href = response.redirect_url;
                    }, 1000);
                } else {
                    $('#login-error').text(response.message);
                }
            },
            error: function(xhr) {
                const response = xhr.responseJSON;
                if (response && response.message) {
                    $('#login-error').text(response.message);
                } else {
                    $('#login-error').text('Login failed. Please try again.');
                }
            }
        });
    });
    
    // Signup form submission
    $('#signup-form').submit(function(e) {
        e.preventDefault();
        clearErrors();
        
        const password = $('#signup-password').val();
        const confirmPassword = $('#signup-confirm-password').val();
        
        if (password !== confirmPassword) {
            $('#signup-confirm-password-error').text('Passwords do not match');
            return;
        }
        
        if (!$('#signup-track').val()) {
            $('#signup-track-error').text('Please select a study track');
            return;
        }
        
        const formData = {
            name: $('#signup-name').val(),
            email: $('#signup-email').val(),
            password: password,
            confirm_password: confirmPassword,
            track: $('#signup-track').val()
        };
        
        $.ajax({
            url: '{{ url_for("auth.signup") }}',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function(response) {
                if (response.success) {
                    $('#signup-success').text(response.message);
                    setTimeout(function() {
                        window.location.href = response.redirect_url;
                    }, 1000);
                } else {
                    $('#signup-error').text(response.message);
                }
            },
            error: function(xhr) {
                const response = xhr.responseJSON;
                if (response && response.message) {
                    $('#signup-error').text(response.message);
                } else {
                    $('#signup-error').text('Registration failed. Please try again.');
                }
            }
        });
    });
    
    // Email availability check
    let emailCheckTimeout;
    $('#signup-email').on('input', function() {
        const email = $(this).val();
        
        clearTimeout(emailCheckTimeout);
        $('#signup-email-error').text('');
        
        if (email.length > 0 && email.includes('@')) {
            emailCheckTimeout = setTimeout(function() {
                $.ajax({
                    url: '{{ url_for("auth.check_email") }}',
                    method: 'GET',
                    data: { email: email },
                    success: function(response) {
                        if (!response.available) {
                            $('#signup-email-error').text(response.message);
                        }
                    }
                });
            }, 500);
        }
    });
    
    function clearErrors() {
        $('.error-message, .success-message').text('');
    }
    
    // Password strength indicator
    $('#signup-password').on('input', function() {
        const password = $(this).val();
        let strength = 0;
        let message = '';
        
        if (password.length >= 6) strength++;
        if (/[A-Za-z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^A-Za-z0-9]/.test(password)) strength++;
        
        if (password.length > 0) {
            if (strength < 2) {
                message = 'Weak password';
                $('#signup-password-error').text(message).css('color', '#dc3545');
            } else if (strength < 3) {
                message = 'Medium password';
                $('#signup-password-error').text(message).css('color', '#ffc107');
            } else {
                message = 'Strong password';
                $('#signup-password-error').text(message).css('color', '#28a745');
            }
        }
    });
});
</script>
{% endblock %}
